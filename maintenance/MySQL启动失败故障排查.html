<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MySQL启动失败故障排查 | 前端程序员备忘录</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="https://www.orzzone.com/projects/cdn/favicon.ico">
    <meta name="description" content="《前端程序员备忘录》是前端基础知识和前端面试题的集锦。">
    
    <link rel="preload" href="/memo/assets/css/0.styles.3bcd4494.css" as="style"><link rel="preload" href="/memo/assets/js/app.475facf6.js" as="script"><link rel="preload" href="/memo/assets/js/2.ee3c45b5.js" as="script"><link rel="preload" href="/memo/assets/js/42.480ec4e9.js" as="script"><link rel="prefetch" href="/memo/assets/js/10.2d48feea.js"><link rel="prefetch" href="/memo/assets/js/11.14eb4961.js"><link rel="prefetch" href="/memo/assets/js/12.89451e86.js"><link rel="prefetch" href="/memo/assets/js/13.b7c01214.js"><link rel="prefetch" href="/memo/assets/js/14.b7cebc8a.js"><link rel="prefetch" href="/memo/assets/js/15.53fcf755.js"><link rel="prefetch" href="/memo/assets/js/16.2c00e0a9.js"><link rel="prefetch" href="/memo/assets/js/17.51fff933.js"><link rel="prefetch" href="/memo/assets/js/18.0a3552fc.js"><link rel="prefetch" href="/memo/assets/js/19.96af495d.js"><link rel="prefetch" href="/memo/assets/js/20.11c6a142.js"><link rel="prefetch" href="/memo/assets/js/21.f28e9395.js"><link rel="prefetch" href="/memo/assets/js/22.fadbac1c.js"><link rel="prefetch" href="/memo/assets/js/23.e85ea71f.js"><link rel="prefetch" href="/memo/assets/js/24.02f0d102.js"><link rel="prefetch" href="/memo/assets/js/25.ab337d3b.js"><link rel="prefetch" href="/memo/assets/js/26.76045d1b.js"><link rel="prefetch" href="/memo/assets/js/27.7f13f711.js"><link rel="prefetch" href="/memo/assets/js/28.91c040c5.js"><link rel="prefetch" href="/memo/assets/js/29.07a9a56b.js"><link rel="prefetch" href="/memo/assets/js/3.11e8a832.js"><link rel="prefetch" href="/memo/assets/js/30.ce455747.js"><link rel="prefetch" href="/memo/assets/js/31.a9392249.js"><link rel="prefetch" href="/memo/assets/js/32.48e78443.js"><link rel="prefetch" href="/memo/assets/js/33.692bab43.js"><link rel="prefetch" href="/memo/assets/js/34.1ca7d87f.js"><link rel="prefetch" href="/memo/assets/js/35.a0554dc4.js"><link rel="prefetch" href="/memo/assets/js/36.3ea99423.js"><link rel="prefetch" href="/memo/assets/js/37.62684a38.js"><link rel="prefetch" href="/memo/assets/js/38.2c2ff6be.js"><link rel="prefetch" href="/memo/assets/js/39.33beed23.js"><link rel="prefetch" href="/memo/assets/js/4.d0e01616.js"><link rel="prefetch" href="/memo/assets/js/40.de4a23e9.js"><link rel="prefetch" href="/memo/assets/js/41.4abc8617.js"><link rel="prefetch" href="/memo/assets/js/43.4355956f.js"><link rel="prefetch" href="/memo/assets/js/44.16821d7b.js"><link rel="prefetch" href="/memo/assets/js/45.ccc0ad47.js"><link rel="prefetch" href="/memo/assets/js/46.702d729d.js"><link rel="prefetch" href="/memo/assets/js/47.530ac8e7.js"><link rel="prefetch" href="/memo/assets/js/48.87fde348.js"><link rel="prefetch" href="/memo/assets/js/49.0fc9da04.js"><link rel="prefetch" href="/memo/assets/js/5.525308c6.js"><link rel="prefetch" href="/memo/assets/js/50.76c019a6.js"><link rel="prefetch" href="/memo/assets/js/51.f6756562.js"><link rel="prefetch" href="/memo/assets/js/52.e64348d8.js"><link rel="prefetch" href="/memo/assets/js/53.8d31df4c.js"><link rel="prefetch" href="/memo/assets/js/54.b6162061.js"><link rel="prefetch" href="/memo/assets/js/55.9017efcb.js"><link rel="prefetch" href="/memo/assets/js/56.9e9c1ebb.js"><link rel="prefetch" href="/memo/assets/js/57.82321609.js"><link rel="prefetch" href="/memo/assets/js/58.da440960.js"><link rel="prefetch" href="/memo/assets/js/59.2f34a426.js"><link rel="prefetch" href="/memo/assets/js/6.7885a851.js"><link rel="prefetch" href="/memo/assets/js/7.3f5e44c5.js"><link rel="prefetch" href="/memo/assets/js/8.4c151ed8.js"><link rel="prefetch" href="/memo/assets/js/9.fede72ab.js">
    <link rel="stylesheet" href="/memo/assets/css/0.styles.3bcd4494.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/memo/" class="home-link router-link-active"><img src="https://www.orzzone.com/projects/cdn/favicon.png" alt="前端程序员备忘录" class="logo"> <span class="site-name can-hide">前端程序员备忘录</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/memo/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/memo/SUMMARY.html" class="nav-link">
  总论
</a></div><div class="nav-item"><a href="https://www.orzzone.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  作者博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/memo/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/memo/SUMMARY.html" class="nav-link">
  总论
</a></div><div class="nav-item"><a href="https://www.orzzone.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  作者博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/memo/SUMMARY.html" class="sidebar-link">总论</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/memo/SUMMARY.html#仓库地址" class="sidebar-link">仓库地址</a></li><li class="sidebar-sub-header"><a href="/memo/SUMMARY.html#面试准备" class="sidebar-link">面试准备</a></li></ul></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>综合</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>DOM操作</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ES语法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTML</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>运维</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/memo/maintenance/linux系统和常用命令.html" class="sidebar-link">linux系统和常用命令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/memo/maintenance/linux系统和常用命令.html#获取linux环境" class="sidebar-link">获取linux环境</a></li><li class="sidebar-sub-header"><a href="/memo/maintenance/linux系统和常用命令.html#常用linux命令" class="sidebar-link">常用linux命令</a></li></ul></li><li><a href="/memo/maintenance/MySQL启动失败故障排查.html" class="active sidebar-link">MySQL启动失败故障排查</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/memo/maintenance/MySQL启动失败故障排查.html#_1、查看mysql配置文件" class="sidebar-link">1、查看mysql配置文件</a></li><li class="sidebar-sub-header"><a href="/memo/maintenance/MySQL启动失败故障排查.html#查看mysql错误日志" class="sidebar-link">查看mysql错误日志</a></li><li class="sidebar-sub-header"><a href="/memo/maintenance/MySQL启动失败故障排查.html#查询内存情况" class="sidebar-link">查询内存情况</a></li><li class="sidebar-sub-header"><a href="/memo/maintenance/MySQL启动失败故障排查.html#修改mysql配置文件" class="sidebar-link">修改mysql配置文件</a></li><li class="sidebar-sub-header"><a href="/memo/maintenance/MySQL启动失败故障排查.html#重启mysql服务" class="sidebar-link">重启mysql服务</a></li><li class="sidebar-sub-header"><a href="/memo/maintenance/MySQL启动失败故障排查.html#验证mysql服务是否正常" class="sidebar-link">验证mysql服务是否正常</a></li></ul></li><li><a href="/memo/maintenance/Vim编辑器常用快捷键.html" class="sidebar-link">Vim编辑器常用快捷键</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/memo/maintenance/Vim编辑器常用快捷键.html#光标移动-cursor-movement" class="sidebar-link">光标移动（Cursor Movement）</a></li><li class="sidebar-sub-header"><a href="/memo/maintenance/Vim编辑器常用快捷键.html#插入模式-insert-mode" class="sidebar-link">插入模式（Insert Mode）</a></li><li class="sidebar-sub-header"><a href="/memo/maintenance/Vim编辑器常用快捷键.html#编辑-editing" class="sidebar-link">编辑（Editing）</a></li><li class="sidebar-sub-header"><a href="/memo/maintenance/Vim编辑器常用快捷键.html#关闭-exiting" class="sidebar-link">关闭（Exiting）</a></li><li class="sidebar-sub-header"><a href="/memo/maintenance/Vim编辑器常用快捷键.html#搜索-search" class="sidebar-link">搜索（Search）</a></li><li class="sidebar-sub-header"><a href="/memo/maintenance/Vim编辑器常用快捷键.html#视觉模式-visual-mode" class="sidebar-link">视觉模式（Visual Mode）</a></li><li class="sidebar-sub-header"><a href="/memo/maintenance/Vim编辑器常用快捷键.html#剪切和复制-cut-and-paste" class="sidebar-link">剪切和复制（Cut and Paste）</a></li><li class="sidebar-sub-header"><a href="/memo/maintenance/Vim编辑器常用快捷键.html#窗口操作" class="sidebar-link">窗口操作</a></li><li class="sidebar-sub-header"><a href="/memo/maintenance/Vim编辑器常用快捷键.html#参考资料" class="sidebar-link">参考资料</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>网站</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>软技能</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>源码</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>样式</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="https://github.com/formulahendry/955.WLB" target="_blank" rel="noopener noreferrer" class="sidebar-link">955工作生活平衡名单<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mysql启动失败故障排查"><a href="#mysql启动失败故障排查" class="header-anchor">#</a> MySQL启动失败故障排查</h1> <h2 id="_1、查看mysql配置文件"><a href="#_1、查看mysql配置文件" class="header-anchor">#</a> 1、查看mysql配置文件</h2> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">vi</span> /etc/my.cnf
</code></pre></div><p>得到类似如下的内容：</p> <div class="language- extra-class"><pre class="language-text"><code># For advice on how to change settings please see
# http://dev.mysql.com/doc/refman/5.7/en/server-configuration-defaults.html

[mysqld]
#
# Remove leading # and set to the amount of RAM for the most important data
# cache in MySQL. Start at 70% of total RAM for dedicated server, else 10%.
innodb_buffer_pool_size = 512M
#
# Remove leading # to turn on a very important data integrity option: logging
# changes to the binary log between backups.
# log_bin
#
# Remove leading # to set options mainly useful for reporting servers.
# The server defaults are faster for transactions and fast SELECTs.
# Adjust sizes as needed, experiment to find the optimal values.
join_buffer_size = 512M
sort_buffer_size = 16M
read_rnd_buffer_size = 16M
datadir=/var/lib/mysql
socket=/var/lib/mysql/mysql.sock

# Disabling symbolic-links is recommended to prevent assorted security risks
symbolic-links=0

log-error=/var/log/mysqld.log
pid-file=/var/run/mysqld/mysqld.pid
</code></pre></div><p>在文件底部可看到<code>log-error=/var/log/mysqld.log</code>，说明可通过<code>/var/log/mysqld.log</code>文件查看mysql错误日志。</p> <h2 id="查看mysql错误日志"><a href="#查看mysql错误日志" class="header-anchor">#</a> 查看mysql错误日志</h2> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">vi</span> /var/log/mysqld.log
</code></pre></div><p>将日志文件拉到底部查看最新日志，得到如下内容：</p> <div class="language- extra-class"><pre class="language-text"><code>2018-05-31T09:21:12.658310Z 0 [Warning] TIMESTAMP with implicit DEFAULT value is deprecated. Please use --explicit_defaults_for_timestamp server option (see documentation for more details).
2018-05-31T09:21:12.662935Z 0 [Note] /usr/sbin/mysqld (mysqld 5.7.20) starting as process 7606 ...
2018-05-31T09:21:12.670651Z 0 [Note] InnoDB: PUNCH HOLE support available
2018-05-31T09:21:12.670730Z 0 [Note] InnoDB: Mutexes and rw_locks use GCC atomic builtins
2018-05-31T09:21:12.670744Z 0 [Note] InnoDB: Uses event mutexes
2018-05-31T09:21:12.670797Z 0 [Note] InnoDB: GCC builtin __atomic_thread_fence() is used for memory barrier
2018-05-31T09:21:12.670820Z 0 [Note] InnoDB: Compressed tables use zlib 1.2.3
2018-05-31T09:21:12.670834Z 0 [Note] InnoDB: Using Linux native AIO
2018-05-31T09:21:12.671543Z 0 [Note] InnoDB: Number of pools: 1
2018-05-31T09:21:12.671846Z 0 [Note] InnoDB: Using CPU crc32 instructions
2018-05-31T09:21:12.675677Z 0 [Note] InnoDB: Initializing buffer pool, total size = 512M, instances = 1, chunk size = 128M
2018-05-31T09:21:12.675802Z 0 [ERROR] InnoDB: mmap(137428992 bytes) failed; errno 12
2018-05-31T09:21:12.675827Z 0 [ERROR] InnoDB: Cannot allocate memory for the buffer pool
2018-05-31T09:21:12.675847Z 0 [ERROR] InnoDB: Plugin initialization aborted with error Generic error
2018-05-31T09:21:12.675871Z 0 [ERROR] Plugin 'InnoDB' init function returned error.
2018-05-31T09:21:12.675883Z 0 [ERROR] Plugin 'InnoDB' registration as a STORAGE ENGINE failed.
2018-05-31T09:21:12.675900Z 0 [ERROR] Failed to initialize plugins.
2018-05-31T09:21:12.675911Z 0 [ERROR] Aborting

2018-05-31T09:21:12.675976Z 0 [Note] Binlog end
2018-05-31T09:21:12.676874Z 0 [Note] Shutting down plugin 'CSV'
2018-05-31T09:21:12.677837Z 0 [Note] /usr/sbin/mysqld: Shutdown complete
</code></pre></div><p>发现：</p> <div class="language- extra-class"><pre class="language-text"><code>2018-05-31T09:21:12.675677Z 0 [Note] InnoDB: Initializing buffer pool, total size = 512M, instances = 1, chunk size = 128M
2018-05-31T09:21:12.675802Z 0 [ERROR] InnoDB: mmap(137428992 bytes) failed; errno 12
2018-05-31T09:21:12.675827Z 0 [ERROR] InnoDB: Cannot allocate memory for the buffer pool
</code></pre></div><p>应该是内存不够启动mysql服务了。</p> <p>注意：报错信息里所需内存大小为：137428992 bytes = 137428992 / 1024 / 1024 M = 131.0625 M</p> <h2 id="查询内存情况"><a href="#查询内存情况" class="header-anchor">#</a> 查询内存情况</h2> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 以M为单位显示内存情况</span>
<span class="token function">free</span> -m
</code></pre></div><p>得到：</p> <div class="language- extra-class"><pre class="language-text"><code># free -m
              total        used        free      shared  buff/cache   available
Mem:           1946        1829          16           4         100          70
Swap:          1023        1001          22
</code></pre></div><p>发现此时服务器相关内存情况为：</p> <ul><li>free: 16 M</li> <li>buff/cache: 100 M</li> <li>available: 70 M</li></ul> <p>这几个数据量都很可怜了。所以我们可以增大可用内存，停掉一些不用的服务，或者减少mysql所需内存。</p> <h2 id="修改mysql配置文件"><a href="#修改mysql配置文件" class="header-anchor">#</a> 修改mysql配置文件</h2> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">vi</span> /etc/my.cnf
</code></pre></div><p>然后：</p> <ul><li>将<code>innodb_buffer_pool_size = 512M</code>修改为<code>innodb_buffer_pool_size = 64M</code></li> <li>将<code>join_buffer_size = 512M</code>改为<code>join_buffer_size = 64M</code></li></ul> <h2 id="重启mysql服务"><a href="#重启mysql服务" class="header-anchor">#</a> 重启mysql服务</h2> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">service</span> mysqld restart
</code></pre></div><h2 id="验证mysql服务是否正常"><a href="#验证mysql服务是否正常" class="header-anchor">#</a> 验证mysql服务是否正常</h2> <p>打开网站，发现数据展示正常</p> <p>完毕</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最近更新时间:</span> <span class="time">5/31/2021, 9:54:28 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/memo/maintenance/linux系统和常用命令.html" class="prev">
        linux系统和常用命令
      </a></span> <span class="next"><a href="/memo/maintenance/Vim编辑器常用快捷键.html">
        Vim编辑器常用快捷键
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/memo/assets/js/app.475facf6.js" defer></script><script src="/memo/assets/js/2.ee3c45b5.js" defer></script><script src="/memo/assets/js/42.480ec4e9.js" defer></script>
  </body>
</html>
